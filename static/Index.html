<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Universal YouTube Downloader</title>
    <style>
        /* [Keep all previous CSS styles] */
        .url-types {
            background: #e3f2fd;
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
            text-align: left;
        }
        .url-types h3 {
            margin-bottom: 10px;
            color: #0d47a1;
        }
        .url-types ul {
            padding-left: 20px;
        }
        .url-types li {
            margin-bottom: 8px;
            font-size: 15px;
        }
        .url-example {
            display: inline-block;
            background: #bbdefb;
            padding: 2px 8px;
            border-radius: 4px;
            font-family: monospace;
            margin: 3px 0;
        }
        .original-url {
            font-size: 14px;
            color: #666;
            margin-top: 5px;
            word-break: break-all;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="logo">ðŸ“±</div>
        <h1>Universal YouTube Downloader</h1>
        <p class="description">Works with any YouTube link format - videos, shorts, mobile shares, and more!</p>
        
        <div class="input-group">
            <input type="text" id="youtubeUrl" placeholder="Paste any YouTube link here...">
            <button id="extractBtn">Get Direct Link</button>
        </div>
        
        <div class="url-types">
            <h3>Supported Link Formats:</h3>
            <ul>
                <li>Standard: <span class="url-example">https://www.youtube.com/watch?v=dQw4w9WgXcQ</span></li>
                <li>Mobile Share: <span class="url-example">https://youtu.be/dQw4w9WgXcQ</span></li>
                <li>YouTube Shorts: <span class="url-example">https://www.youtube.com/shorts/VIDEO_ID</span></li>
                <li>Embedded: <span class="url-example">https://www.youtube.com/embed/dQw4w9WgXcQ</span></li>
                <li>With Parameters: <span class="url-example">https://youtube.com/watch?v=dQw4w9WgXcQ&feature=share</span></li>
            </ul>
        </div>
        
        <div class="loader" id="loader"></div>
        <div id="errorBox" class="error"></div>
        
        <div id="resultBox" class="result">
            <h2>Download Ready</h2>
            <div class="original-url" id="originalUrl"></div>
            
            <div class="result-content">
                <img id="videoThumbnail" class="thumbnail" src="" alt="Video thumbnail">
                <div class="result-details">
                    <div class="result-item">
                        <span class="result-label">Video Title:</span>
                        <span id="videoTitle" class="result-value">Loading...</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">Direct Video URL:</span>
                        <a id="directUrl" target="_blank" class="result-value">Click to Download</a>
                    </div>
                </div>
            </div>
            
            <div class="instructions">
                <p><strong>How to download:</strong></p>
                <ol>
                    <li>Right-click the "Click to Download" link</li>
                    <li>Select "Save link as..."</li>
                    <li>Choose where to save the video</li>
                </ol>
                <p><strong>Note:</strong> Links expire after 6 hours. Download immediately for best results.</p>
            </div>
        </div>
        
        <div class="footer">
            <p>Works with all devices and browsers â€¢ Deployed on Render.com</p>
            <p>This service does not store any videos - direct download from YouTube</p>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const urlInput = document.getElementById('youtubeUrl');
            const extractBtn = document.getElementById('extractBtn');
            const errorBox = document.getElementById('errorBox');
            const resultBox = document.getElementById('resultBox');
            const videoTitle = document.getElementById('videoTitle');
            const videoThumbnail = document.getElementById('videoThumbnail');
            const directUrl = document.getElementById('directUrl');
            const originalUrl = document.getElementById('originalUrl');
            const loader = document.getElementById('loader');
            
            // Focus input on load
            urlInput.focus();
            
            // Handle paste events
            urlInput.addEventListener('paste', (e) => {
                setTimeout(() => {
                    const text = urlInput.value.trim();
                    if (isValidYoutubeUrl(text)) {
                        extractLink();
                    }
                }, 10);
            });
            
            extractBtn.addEventListener('click', extractLink);
            urlInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') extractLink();
            });
            
            function isValidYoutubeUrl(url) {
                // Match all YouTube URL formats
                const patterns = [
                    /https?:\/\/(?:www\.)?youtube\.com\/watch\?v=[a-zA-Z0-9_-]{11}/,
                    /https?:\/\/(?:www\.)?youtube\.com\/shorts\/[a-zA-Z0-9_-]{11}/,
                    /https?:\/\/youtu\.be\/[a-zA-Z0-9_-]{11}/,
                    /https?:\/\/(?:www\.)?youtube\.com\/embed\/[a-zA-Z0-9_-]{11}/,
                    /https?:\/\/(?:www\.)?youtube\.com\/v\/[a-zA-Z0-9_-]{11}/
                ];
                
                return patterns.some(pattern => pattern.test(url));
            }
            
            async function extractLink() {
                const url = urlInput.value.trim();
                
                // Reset UI
                errorBox.style.display = 'none';
                resultBox.style.display = 'none';
                extractBtn.disabled = true;
                loader.style.display = 'block';
                extractBtn.textContent = 'Processing...';
                
                // Validate input
                if (!url) {
                    showError('Please enter a YouTube URL');
                    resetUI();
                    return;
                }
                
                if (!isValidYoutubeUrl(url)) {
                    showError('Please enter a valid YouTube URL in any format');
                    resetUI();
                    return;
                }
                
                try {
                    const response = await fetch('/get-url', {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({ url })
                    });
                    
                    const data = await response.json();
                    
                    if (response.ok) {
                        // Display results
                        videoTitle.textContent = data.title || 'Untitled';
                        directUrl.href = data.direct_url;
                        directUrl.textContent = 'Download Video (Right-click Save)';
                        
                        if (data.thumbnail) {
                            videoThumbnail.src = data.thumbnail;
                            videoThumbnail.alt = data.title || 'Video thumbnail';
                        }
                        
                        // Show original URL
                        originalUrl.textContent = `Original URL: ${data.original_url}`;
                        
                        resultBox.style.display = 'block';
                        resultBox.scrollIntoView({ behavior: 'smooth' });
                    } else {
                        showError(data.error || `Error ${response.status}: Failed to process URL`);
                    }
                } catch (error) {
                    showError(`Network error: ${error.message}`);
                } finally {
                    resetUI();
                }
            }
            
            function resetUI() {
                extractBtn.disabled = false;
                extractBtn.textContent = 'Get Direct Link';
                loader.style.display = 'none';
            }
            
            function showError(message) {
                errorBox.textContent = message;
                errorBox.style.display = 'block';
                errorBox.scrollIntoView({ behavior: 'smooth' });
            }
        });
    </script>
</body>
</html>
